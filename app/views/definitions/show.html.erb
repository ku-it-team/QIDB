<div class="row">
  <div class="col-xs-12">
    <%= form_tag search_path, {method: "get"} do %>
      <h3><b>検索キーワード</b></h3>
      <div class="input-group">
        <%= text_field_tag 'query', params['query'], :class => 'form-control input', :id => "btn-input", :placeholder => '大動脈バルーンパンピング法　人工心肺' %>
        <span class="input-group-btn">
          <%= submit_tag "　検　索　", :class => "btn btn-info btn", :id => "btn-chat" %>
        </span>
      </div>
    <% end %>
  </div>
</div><br>

<div class="row">
  <div class="col-xs-12">
    <div class="panel panel-info">
      <div class="panel-heading">
        <label>整理番号</label>
        <%= @definition['指標番号'].to_s %>
      </div>
      <div class="panel-body">
        <label>プロジェクト名</label>: <%= @definition['プロジェクト名'] %></p>
        <label>年度</label>: <%= @definition['年度'] %></p>
        <label>更新日</label>: <%= @definition['更新日'] %></p>
        <label>指標群</label>: <%= @definition['指標群'] %></p>
        <label>名称</label>: <%= @definition['名称'] %></p>
        <label>意義</label>: <%= @definition['意義'] %></p>
        <label>必要データセット</label>:
        <% @definition['必要なデータセット'].each do |var| %>
          <%= var %>&nbsp;
        <% end %></p>
        <label>定義の要約</label>:</p>
        <label>分子</label>: <%= @definition['定義の要約']['分子'] %></p>
        <label>分母</label>: <%= @definition['定義の要約']['分母'] %></p>
        <label>指標の定義算出方法</label>:</p>
        <% @definition['指標の定義/算出方法']['分母の定義'].each do |key,value| %>
          <label>分母の定義<%= key %></label>:</p>
          説明:<%= value['説明'] %></p>
          <% if value['data'].present? %>
            <div class="col-lg-12">
              <div class="panel panel-default">
                <div class="panel-heading">分母のデータ</div>
                  <div class="panel-body">
                    <div class="table-responsive">
                      <table class="table table-striped table-bordered table-hover">
                        <thead>
                          <tr>
                            <% value['data'].each do |i| %>
                              <th><%= i.keys %></th>
                            <% end %>
                          </tr>
                        </thead>
                        <tbody>
                          <% value['data'][0].values[0].length.times do |id| %>
                            <tr>
                              <% value['data'].each do |i| %>
                                <td><%= i.values[0][id] %></td>
                              <% end %>
                            </tr>
                            <% id+=1 %>
                          <% end %>
                        </tbody>
                      </table>
                    </div>
                    <!-- /.table-responsive -->
                  </div>
                  <!-- /.panel-body -->
              </div>
              <!-- /.panel -->
            </div>
            <!-- /.col-lg-12 -->
          <% end %>
        <% end %>

        <% @definition['指標の定義/算出方法']['分子の定義'].each do |key,value| %>
          <label>分母の定義<%= key %></label>:</p>
          説明:<%= value['説明'] %></p>
          <% if value['data'].present? %>
            <div class="col-lg-12">
              <div class="panel panel-default">
                <div class="panel-heading">分子のデータ</div>
                <div class="panel-body">
                  <div class="table-responsive">
                    <table class="table table-striped table-bordered table-hover">
                      <thead>
                        <tr>
                          <% value['data'].each do |i| %>
                          <th><%= i.keys %></th>
                          <% end %>
                        </tr>
                      </thead>
                      <tbody>
                        <% value['data'][0].values[0].length.times do |id| %>
                        <tr>
                          <% value['data'].each do |i| %>
                          <td><%= i.values[0][id] %></td>
                          <% end %>
                        </tr>
                        <% id+=1 %>
                        <% end %>
                      </tbody>
                    </table>
                  </div>
                  <!-- /.table-responsive -->
                </div>
                <!-- /.panel-body -->
              </div>
              <!-- /.panel -->
            </div>
            <!-- /.col-lg-12 -->
          <% end %>
        <% end %>
        <label>薬剤一覧の出力</label>: <%= @definition['薬剤出力一覧'] %></p>
        <label>リスク調整因子の定義</label>: <%= @definition['リスクの調整因子の定義'] %></p>
        <label>指標の算出方法(説明)</label>: <%= @definition['指標の算出方法']['説明'] %></p>
        <label>指標の算出方法(単位)</label>: <%= @definition['指標の算出方法']['分母'] %></p>
        <label>測定上の限界・解釈上の注意</label>: <%= @definition['測定上の限界/解釈上の注意'] %></p>
        <label>参考値</label>: <%= @definition['参考値'] %></p>

        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <label data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="false" class="collapsed">
                参考資料
              </label>
            </h4>
          </div>
          <div id="collapseOne" class="panel-collapse collapse" aria-expanded="false" style="height: 0px;">
            <div class="panel-body">
              <% @definition['参考資料'].each do |var| %>
              <%= var %></p>
              <% end %>
            </div>
          </div>
        </div>

        <label>定義見直しのタイミング</label>: <%= @definition['定義見直しのタイミング'] %></p>


          <div class="panel panel-default">
            <div class="panel-heading">
              <h4 class="panel-title">
                <label data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="false" class="collapsed">
                  変更履歴
                </label>
              </h4>
            </div>

            <div id="collapseTwo" class="panel-collapse collapse" aria-expanded="false" style="height: 0px;">
              <div class="panel-body">
                <% @logs.each do |log| %>
                  <label>変更者</label>: <%= log['変更者'] %></p>
                  <label>変更メッセージ</label>: <%= log['変更メッセージ'] %></p>
                <% end %>
              </div>
            </div>
          </div>
　

    </div>
  </div>
</div>

<%= link_to '編集', edit_definition_path %>
